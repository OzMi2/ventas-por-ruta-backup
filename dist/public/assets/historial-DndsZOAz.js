import{c as m}from"./index-CAkiVclH.js";import{a as b}from"./offlineCache-8_501Z3e.js";const h=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],N=m("file-text",h);function a(o){const r=Number(o);return Number.isFinite(r)?r:0}async function P(){try{return(await b.getRutas()).rutas.map(r=>({id:r.id.toString(),nombre:r.nombre}))}catch{return[]}}async function y(o){try{const r=parseInt(o.rutaId),[c,s]=await Promise.all([b.getClientes(r),b.getVentas({rutaId:r})]),n={};for(const i of c.clientes)n[i.id.toString()]={cliente_id:i.id.toString(),cliente_nombre:i.nombre,saldo_actual:parseFloat(i.saldo||"0"),ventas:[]};for(const i of s.ventas){const t=i.clienteId.toString();if(n[t]){const e=g(i);e.saldo_final===0&&e.saldo_anterior===0&&(e.saldo_final=n[t].saldo_actual||0),n[t].ventas.push(e)}}return Object.values(n)}catch{return[]}}async function U(o){try{const[r,c]=await Promise.all([b.getVentas({}),b.getClientes()]),s={};for(const n of c.clientes)s[n.id.toString()]={nombre:n.nombre,saldo:parseFloat(n.saldo||"0")};return r.ventas.map(n=>{const i=g(n),t=s[i.cliente_id];return i.cliente_nombre=t?.nombre||`Cliente ${i.cliente_id}`,i.saldo_final===0&&i.saldo_anterior===0&&(i.saldo_final=t?.saldo||0),i})}catch(r){return console.error("Error loading ventas vendedor:",r),[]}}function g(o){const r=(o.items||[]).map(e=>{const d=(e.productoUnidad||e.unidad||"PIEZA").toUpperCase(),u=d==="KG",_=d==="MIXTO",l=a(e.cantidad);let p=0,f=0;return _?(p=a(e.piezas),f=a(e.kilos),p===0&&f===0&&l>0&&(f=l)):u?(f=a(e.kilos)||l,p=0):(p=l,f=0),{productoId:e.productoId||0,producto:e.productoNombre||`Producto ${e.productoId}`,tipo_venta:u||_?"peso":"unidad",cantidad:p,kilos:f,piezas:p,precio_unitario:a(e.precioUnitario),descuento_unitario:a(e.descuentoUnitario||e.descuento||0),subtotal:a(e.subtotal),unidad:d}}),c=a(o.subtotal),s=a(o.descuento),n=a(o.total),i=a(o.abono);let t=o.tipoPago||"";return t||(i===0?t="credito":i<n?t="parcial":t="contado"),{id:o.id?.toString()||o.clienteTxId,folio:o.id?.toString()||o.clienteTxId?.slice(0,8)||"â€”",fecha_iso:o.fechaVenta instanceof Date?o.fechaVenta.toISOString():String(o.fechaVenta),ruta:o.rutaId?.toString()||"",ruta_nombre:o.rutaNombre||"",cliente_id:o.clienteId?.toString()||"",cliente_nombre:"",vendedor_id:o.usuarioId?.toString()||"",vendedor_nombre:o.vendedorNombre||"",tipo_pago:t,subtotal_base:c,descuentos:s,total:n,abono:i,saldo_anterior:a(o.saldoAnterior),saldo_final:a(o.saldoFinal),pago_cliente:a(o.pagoCliente),cambio:a(o.cambio),items:r}}async function k(o){try{const r=new URLSearchParams;o.fechaDesde&&r.set("fechaDesde",o.fechaDesde),o.fechaHasta&&r.set("fechaHasta",o.fechaHasta);const c=localStorage.getItem("auth_token"),s=await fetch(`/api/ventas/todas?${r.toString()}`,{headers:{Authorization:`Bearer ${c}`}});return s.ok?((await s.json())?.ventas||[]).map(t=>({id:String(t.id),folio:String(t.id),fecha_iso:t.fechaIso||t.fechaVenta||"",ruta_nombre:t.ruta_nombre||"",cliente_id:String(t.clienteId),cliente_nombre:t.cliente_nombre||"",vendedor_id:String(t.usuarioId),vendedor_nombre:t.vendedorNombre||"",tipo_pago:t.tipoPago==="contado"||t.tipoPago==="credito"||t.tipoPago==="parcial"||t.tipoPago==="abono"?t.tipoPago:"contado",saldo_anterior:a(t.saldoAnterior),saldo_final:a(t.saldoFinal),pago_cliente:a(t.pagoCliente),cambio:a(t.cambio),total:a(t.total),descuentos:a(t.descuentos),abono:a(t.abono),items:(t.items||[]).map(e=>{const d=(e.unidad||e.productoUnidad||"PIEZA").toUpperCase(),u=a(e.cantidad),_=d==="MIXTO",l=d==="KG";return{productoId:e.productoId||0,producto:e.productoNombre||"",productoNombre:e.productoNombre||"",unidad:d,tipo_venta:d,cantidad:u,piezas:_?a(e.piezas):l?0:u,kilos:l?u:_?a(e.kilos):0,precio_unitario:a(e.precioUnitario),precioUnitario:a(e.precioUnitario),descuento_unitario:a(e.descuentoUnitario)||0,descuentoUnitario:a(e.descuentoUnitario)||0,subtotal:a(e.subtotal)}})})):[]}catch(r){return console.error("Error fetching todas las ventas:",r),[]}}async function M(o,r,c){try{return((await b.getMovimientosRuta(o,r,c)).movimientos||[]).map(n=>({id:n.id,tipo:n.tipo,productoId:n.productoId,productoNombre:n.productoNombre||`Producto #${n.productoId}`,productoUnidad:n.productoUnidad||"PIEZA",cantidad:n.cantidad,rutaId:n.rutaId,rutaNombre:n.rutaNombre,usuarioId:n.usuarioId,usuarioNombre:n.usuarioNombre||"",notas:n.notas,fecha:n.fecha}))}catch(s){return console.error("Error fetching movimientos ruta:",s),[]}}export{N as F,y as a,k as b,U as c,M as g,P as l};
