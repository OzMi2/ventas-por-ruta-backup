import{u as N,a as v,r,j as e}from"./index--GjonhCH.js";import{g as C,a as y,A as w,B as k,b as S}from"./AppShell-DiZMTW7V.js";import{a as A,B as o}from"./api-DC912d50.js";import{C as d}from"./card-Dph2jOn3.js";import{A as L,a as $,b as E}from"./alert-CCTvRFFI.js";import{S as c}from"./skeleton-AIwg2DpD.js";import{S as B}from"./SearchInput-3SaLZ9az.js";import{A as I}from"./arrow-right-Ci7N85qk.js";import"./search-BBl48DpI.js";async function _(s){try{return(await A.getClientes(s)).clientes}catch(a){const n=C();if(n&&n.length>0)return console.log("Usando clientes desde cache offline"),n;const i=y();if(i?.clientes&&i.clientes.length>0)return console.log("Usando clientes desde bootstrap cache"),i.clientes;throw a}}function T(s,a){const n=s?.id??s?.cliente_id??a;return{id:String(n),nombre:String(s?.nombre??s?.razon_social??s?.cliente??`Cliente ${a+1}`),saldo:s?.saldo!=null?Number(s.saldo):s?.saldo_anterior!=null?Number(s.saldo_anterior):void 0}}function Q(){const[,s]=N(),{state:a,dispatch:n}=v(),[i,j]=r.useState(""),[b,m]=r.useState(!1),[h,x]=r.useState(null),[u,p]=r.useState([]);async function f(){m(!0),x(null);try{const t=await _(),l=Array.isArray(t)?t:Array.isArray(t?.data)?t.data:[];p(l.map(T))}catch(t){x(t?.message||"No se pudieron cargar los clientes."),p([])}finally{m(!1)}}r.useEffect(()=>{f()},[]);const g=u.filter(t=>t.nombre.toLowerCase().includes(i.trim().toLowerCase()));return e.jsx(w,{title:"Seleccionar cliente",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{value:i,onChange:j,placeholder:"Buscar cliente...",testId:"search-clientes"})}),e.jsx(o,{onClick:f,variant:"outline",size:"icon",className:"shrink-0 h-10 w-10 rounded-xl","data-testid":"button-refresh-clientes",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M3 3v5h5"}),e.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"}),e.jsx("path",{d:"M16 16h5v5"})]})})]}),h?e.jsxs(L,{variant:"destructive",className:"rounded-2xl","data-testid":"alert-clientes-error",children:[e.jsx($,{children:"Error"}),e.jsx(E,{"data-testid":"text-clientes-error",children:h})]}):null,b?e.jsx("div",{className:"grid gap-2",children:Array.from({length:6}).map((t,l)=>e.jsx(d,{className:"p-4 rounded-2xl","data-testid":`card-cliente-skeleton-${l}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(c,{className:"h-4 w-2/3"}),e.jsx(c,{className:"mt-2 h-3 w-1/3"})]}),e.jsx(c,{className:"h-8 w-20 rounded-full"})]})},l))}):g.length===0?e.jsxs(d,{className:"p-8 text-center rounded-3xl bg-muted/20 border-dashed","data-testid":"empty-clientes",children:[e.jsx("div",{className:"text-sm font-bold",children:"Sin clientes"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground font-medium",children:u.length===0?"No llegaron datos del API.":"No hay coincidencias."})]}):e.jsx("div",{className:"grid gap-2",children:g.map(t=>e.jsxs(d,{className:`p-3 shadow-sm active:scale-[0.98] transition-transform border-none flex items-center justify-between gap-3 rounded-2xl ${a.selectedClient?.id===t.id?"bg-primary/10 ring-1 ring-primary":"bg-card/60"}`,"data-testid":`card-cliente-${t.id}`,onClick:()=>{a.selectedClient?.id===t.id?n({type:"CLIENT_SET",client:null}):n({type:"CLIENT_SET",client:t})},children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-bold","data-testid":`text-cliente-nombre-${t.id}`,children:t.nombre}),e.jsxs("div",{className:`mt-0.5 text-[11px] font-bold ${t.saldo&&t.saldo>0?"text-destructive":"text-muted-foreground"}`,"data-testid":`text-cliente-saldo-${t.id}`,children:["SALDO: ",t.saldo!=null?`$${Number(t.saldo).toFixed(2)}`:"$0.00"]})]}),e.jsx("div",{className:"shrink-0",children:a.selectedClient?.id===t.id?e.jsx(k,{className:"rounded-full h-6 px-2 text-[10px] font-black uppercase tracking-tighter",children:"LISTO"}):e.jsx(o,{size:"sm",variant:"secondary",className:"h-8 rounded-full text-[11px] font-black uppercase px-4 bg-background shadow-sm border-none","data-testid":`button-select-cliente-${t.id}`,children:"Elegir"})})]},t.id))}),a.selectedClient?e.jsx("div",{className:"sticky bottom-20 sm:bottom-4 left-0 right-0 animate-in slide-in-from-bottom-4",children:e.jsx("div",{className:"rounded-2xl shadow-xl border-primary/20 bg-primary text-primary-foreground p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-widest opacity-80",children:"Cliente Actual"}),e.jsx("div",{className:"text-sm font-bold truncate",children:a.selectedClient.nombre})]}),e.jsxs(o,{onClick:()=>s("/productos"),className:"shrink-0 bg-white/20 hover:bg-white/30 text-white border-none h-10 px-4 rounded-xl font-bold","data-testid":"button-go-inventory",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Inventario",e.jsx(I,{className:"h-4 w-4 ml-1"})]})]})})}):null]})})}export{Q as default};
