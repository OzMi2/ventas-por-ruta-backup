import{r as o,j as e}from"./index-C3FIjBsS.js";import{A as E,R as B,P as I,B as R}from"./AppShell-DP6dkc32.js";import{C as c}from"./card-D08MNxaG.js";import{B as g,I as O,a as v}from"./offlineCache-DoXVbz4G.js";import{S as b,a as j,b as N,c as A,d as s}from"./select-CB6tcY6P.js";import{T as _}from"./truck-t_kh8Rnl.js";function w(a){try{const d=new Date(a);return d.toLocaleDateString()+" "+d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return a}}function P(){const[a,d]=o.useState(!1),[x,S]=o.useState([]),[D,T]=o.useState([]),[r,u]=o.useState("todos"),[l,h]=o.useState(""),[n,p]=o.useState("todos");async function f(){d(!0);try{const[t,i]=await Promise.all([v.getMovimientos(),v.getProductos()]);S(t.movimientos||[]),T(i.productos||[])}catch(t){console.error("Error cargando movimientos:",t)}finally{d(!1)}}o.useEffect(()=>{f()},[]);const m=x.filter(t=>{if(r!=="todos"&&t.productoId!==parseInt(r)||n!=="todos"&&t.tipo!==n)return!1;if(l){const i=new Date(t.fecha);if(`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`!==l)return!1}return!0});return e.jsx(E,{title:"Movimientos de Stock",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsx(c,{className:"p-4 rounded-3xl border-none shadow-sm bg-card/60",children:e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-widest text-muted-foreground","data-testid":"text-movimientos-header",children:"Historial de movimientos"}),e.jsxs("div",{className:"text-sm font-bold","data-testid":"text-movimientos-count",children:[m.length," movimientos"]})]}),e.jsxs(g,{variant:"secondary",className:"h-10 rounded-2xl font-black uppercase text-[10px] gap-2",onClick:f,disabled:a,"data-testid":"button-refresh-movimientos",children:[e.jsx(B,{className:`h-4 w-4 ${a?"animate-spin":""}`}),a?"Cargando...":"Refrescar"]})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1 block",children:"Tipo"}),e.jsxs(b,{value:n,onValueChange:p,children:[e.jsx(j,{className:"h-10 rounded-xl bg-muted/30 border-none font-bold text-sm","data-testid":"select-filtro-tipo",children:e.jsx(N,{placeholder:"Todos los tipos"})}),e.jsxs(A,{className:"rounded-xl",children:[e.jsx(s,{value:"todos",className:"font-bold",children:"Todos"}),e.jsx(s,{value:"ENTRADA_BODEGA",className:"font-bold",children:"Entrada Bodega"}),e.jsx(s,{value:"ENTRADA_BODEGA_MIXTO",className:"font-bold",children:"Entrada Bodega MIXTO"}),e.jsx(s,{value:"SALIDA_BODEGA",className:"font-bold",children:"Salida Bodega"}),e.jsx(s,{value:"SALIDA_BODEGA_MIXTO",className:"font-bold",children:"Salida Bodega MIXTO"}),e.jsx(s,{value:"SALIDA_RUTA",className:"font-bold",children:"Salida a Ruta"}),e.jsx(s,{value:"SALIDA_RUTA_MIXTO",className:"font-bold",children:"Salida a Ruta MIXTO"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1 block",children:"Producto"}),e.jsxs(b,{value:r,onValueChange:u,children:[e.jsx(j,{className:"h-10 rounded-xl bg-muted/30 border-none font-bold text-sm","data-testid":"select-filtro-producto",children:e.jsx(N,{placeholder:"Todos los productos"})}),e.jsxs(A,{className:"rounded-xl max-h-60",children:[e.jsx(s,{value:"todos",className:"font-bold",children:"Todos"}),D.map(t=>e.jsxs(s,{value:String(t.id),className:"font-bold",children:["#",t.id," - ",t.nombre]},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-muted-foreground uppercase mb-1 block",children:"Fecha"}),e.jsx(O,{type:"date",value:l,onChange:t=>h(t.target.value),className:"h-10 rounded-xl bg-muted/30 border-none font-bold","data-testid":"input-filtro-fecha"})]})]}),(r!=="todos"||l||n!=="todos")&&e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 text-xs font-bold",onClick:()=>{u("todos"),h(""),p("todos")},"data-testid":"button-limpiar-filtros",children:"Limpiar filtros"})]})}),e.jsx("div",{className:"grid gap-2",children:a?e.jsx(c,{className:"p-10 rounded-3xl border-dashed bg-muted/20 text-center","data-testid":"loading-movimientos",children:e.jsx("div",{className:"text-xs font-bold text-muted-foreground uppercase",children:"Cargandoâ€¦"})}):m.length===0?e.jsxs(c,{className:"p-10 rounded-3xl border-dashed bg-muted/20 text-center","data-testid":"empty-movimientos",children:[e.jsx("div",{className:"text-sm font-bold",children:"Sin movimientos"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground font-medium",children:x.length>0?"No hay coincidencias con los filtros aplicados.":"No hay movimientos registrados."})]}):m.map(t=>e.jsx(c,{className:"p-4 rounded-2xl border-none shadow-sm bg-card/60","data-testid":`card-movimiento-${t.id}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${t.tipo==="ENTRADA_BODEGA"?"bg-green-100 text-green-700":t.tipo==="SALIDA_BODEGA"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:t.tipo==="ENTRADA_BODEGA"?e.jsx(I,{className:"h-5 w-5"}):e.jsx(_,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(R,{variant:t.tipo==="ENTRADA_BODEGA"?"default":t.tipo==="SALIDA_BODEGA"?"destructive":"secondary",className:"h-5 text-[9px] font-black uppercase","data-testid":`badge-movimiento-tipo-${t.id}`,children:t.tipo==="ENTRADA_BODEGA"?"Entrada":t.tipo==="SALIDA_BODEGA"?"Salida Bodega":t.tipo==="SALIDA_RUTA"?"Salida a Ruta":t.tipo}),e.jsx("span",{className:"text-xs font-bold text-muted-foreground","data-testid":`text-movimiento-fecha-${t.id}`,children:w(t.fecha)})]}),e.jsxs("div",{className:"mt-2 text-sm font-black","data-testid":`text-movimiento-producto-${t.id}`,children:["#",t.productoId," - ",t.productoNombre]}),e.jsxs("div",{className:"mt-1 flex items-center gap-4 text-[11px] font-bold text-muted-foreground",children:[e.jsxs("span",{"data-testid":`text-movimiento-cantidad-${t.id}`,children:["Cantidad: ",e.jsx("span",{className:"text-foreground",children:parseFloat(t.cantidad).toFixed(2)})]}),t.rutaNombre&&e.jsxs("span",{"data-testid":`text-movimiento-ruta-${t.id}`,children:["Ruta: ",e.jsx("span",{className:"text-foreground",children:t.rutaNombre})]})]}),e.jsxs("div",{className:"mt-1 text-[11px] font-bold text-muted-foreground","data-testid":`text-movimiento-usuario-${t.id}`,children:["Por: ",e.jsx("span",{className:"text-foreground",children:t.usuarioNombre})]}),t.notas&&e.jsx("div",{className:"mt-1 text-[11px] font-medium text-muted-foreground italic","data-testid":`text-movimiento-notas-${t.id}`,children:t.notas})]})]})},t.id))})]})})}export{P as default};
