import{b as $,r as n,j as e}from"./index-wdjF8QO9.js";import{A as z,R as T,P as k,B as g}from"./AppShell-dgPPhMBH.js";import{C as p}from"./card-BXHACzTM.js";import{B as l,I as w}from"./api-h81SHs0i.js";import{L as f}from"./label-B6RIRDb6.js";import{S as D,a as A,b as K,c as G,d as j}from"./select-IcSS71jC.js";import{D as O,a as B,b as V,c as F,d as L}from"./dialog-Cc6_pB7Q.js";import{P as M}from"./plus-ButjlTfQ.js";import{P as R}from"./pencil-D-j2D3xz.js";import{T as _}from"./trash-2-CAkFZMoM.js";function te(){const{toast:o}=$(),[b,P]=n.useState([]),[h,N]=n.useState(!0),[C,m]=n.useState(!1),[r,u]=n.useState(null),[s,d]=n.useState({nombre:"",precio:"",unidad:"KG"}),x=async()=>{N(!0);try{const t=localStorage.getItem("auth_token"),a=await fetch("/api/productos",{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Error cargando productos");const i=await a.json();P(i.productos||[])}catch{o({title:"Error",description:"No se pudieron cargar los productos.",variant:"destructive"})}finally{N(!1)}};n.useEffect(()=>{x()},[]);const E=async()=>{if(!s.nombre.trim()||!s.precio||parseFloat(s.precio)<=0){o({title:"Validación",description:"Completa todos los campos correctamente.",variant:"destructive"});return}try{const t=localStorage.getItem("auth_token"),a=r?`/api/productos/${r}`:"/api/productos",c=await fetch(a,{method:r?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({nombre:s.nombre.trim(),precio:parseFloat(s.precio),unidad:s.unidad})});if(!c.ok){const I=await c.json();throw new Error(I.error||`Error ${r?"actualizando":"creando"} producto`)}const v=await c.json();o({title:r?"Producto actualizado":"Producto creado",description:`${v.producto.nombre} con ID #${v.producto.id}`}),m(!1),u(null),d({nombre:"",precio:"",unidad:"KG"}),x()}catch(t){o({title:"Error",description:t.message,variant:"destructive"})}},y=t=>{u(t.id),d({nombre:t.nombre,precio:t.precio,unidad:t.unidad}),m(!0)},S=async t=>{if(confirm(`¿Eliminar el producto "${t.nombre}"? Esta acción no se puede deshacer.`))try{const a=localStorage.getItem("auth_token"),i=await fetch(`/api/productos/${t.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!i.ok){const c=await i.json();throw new Error(c.error||"Error eliminando producto")}o({title:"Producto eliminado",description:t.nombre}),x()}catch(a){o({title:"Error",description:a.message,variant:"destructive"})}};return e.jsx(z,{title:"Gestión de Productos",children:e.jsxs("div",{className:"grid gap-6 pb-20",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsx("h2",{className:"text-xs font-black uppercase tracking-widest text-muted-foreground",children:"Catálogo de Productos"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:x,disabled:h,className:"h-9 rounded-xl font-black uppercase text-[10px] gap-2",children:e.jsx(T,{className:`h-3 w-3 ${h?"animate-spin":""}`})}),e.jsxs(l,{size:"sm",onClick:()=>{u(null),d({nombre:"",precio:"",unidad:"KG"}),m(!0)},className:"h-9 rounded-xl font-black uppercase text-[10px] gap-2","data-testid":"button-new-product",children:[e.jsx(M,{className:"h-3 w-3"})," Nuevo"]})]})]}),e.jsx("div",{className:"grid gap-3",children:h?e.jsx(p,{className:"p-8 text-center rounded-3xl bg-muted/20 border-dashed",children:e.jsx("div",{className:"text-sm font-bold",children:"Cargando..."})}):b.length===0?e.jsxs(p,{className:"p-8 text-center rounded-3xl bg-muted/20 border-dashed",children:[e.jsx("div",{className:"text-sm font-bold",children:"Sin productos"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground font-medium",children:"Crea tu primer producto para empezar."})]}):b.map(t=>e.jsx(p,{className:"p-4 rounded-3xl border-none shadow-sm bg-card/60","data-testid":`card-product-${t.id}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"grid h-12 w-12 place-items-center rounded-2xl bg-primary/10",children:e.jsx(k,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(g,{variant:"outline",className:"text-[8px] font-black",children:["ID: ",t.id]}),e.jsx(g,{variant:"secondary",className:"text-[8px] font-black uppercase",children:t.unidad}),e.jsx(g,{variant:t.activo?"default":"destructive",className:"text-[8px] font-black",children:t.activo?"ACTIVO":"INACTIVO"})]}),e.jsx("div",{className:"text-sm font-black",children:t.nombre})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xl font-black text-primary",children:["$",parseFloat(t.precio).toFixed(2)]}),e.jsxs("div",{className:"text-[9px] text-muted-foreground font-medium",children:["por ",t.unidad==="KG"?"Kg":t.unidad==="MIXTO"?"Mixto":"Pieza"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(l,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>y(t),"data-testid":`button-edit-product-${t.id}`,children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(l,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive",onClick:()=>S(t),"data-testid":`button-delete-product-${t.id}`,children:e.jsx(_,{className:"h-4 w-4"})})]})]})]})},t.id))}),e.jsx(O,{open:C,onOpenChange:t=>{m(t),t||u(null)},children:e.jsxs(B,{className:"max-w-[95%] rounded-3xl",children:[e.jsx(V,{children:e.jsx(F,{className:"font-black uppercase text-center text-sm",children:r?"Editar Producto":"Nuevo Producto"})}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(f,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Nombre del Producto"}),e.jsx(w,{placeholder:"Ej: Huevo, Queso, Jamón...",value:s.nombre,onChange:t=>d(a=>({...a,nombre:t.target.value})),className:"h-11 rounded-2xl bg-muted/30 border-none font-bold","data-testid":"input-nombre"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(f,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Precio"}),e.jsx(w,{type:"number",step:"0.01",min:"0",placeholder:"0.00",value:s.precio,onChange:t=>d(a=>({...a,precio:t.target.value})),className:"h-11 rounded-2xl bg-muted/30 border-none font-bold text-center text-lg","data-testid":"input-precio"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(f,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Unidad de Venta"}),e.jsxs(D,{value:s.unidad,onValueChange:t=>d(a=>({...a,unidad:t})),children:[e.jsx(A,{className:"h-11 rounded-2xl bg-muted/30 border-none font-bold","data-testid":"select-unidad",children:e.jsx(K,{})}),e.jsxs(G,{className:"rounded-2xl",children:[e.jsx(j,{value:"KG",className:"font-bold",children:"Kilogramos (KG)"}),e.jsx(j,{value:"PIEZA",className:"font-bold",children:"Piezas (PIEZA)"}),e.jsx(j,{value:"MIXTO",className:"font-bold",children:"Mixto (Piezas + Kg)"})]})]})]}),e.jsxs(p,{className:"p-3 rounded-2xl bg-muted/30",children:[e.jsx("div",{className:"text-[9px] font-black text-muted-foreground uppercase mb-1",children:"Vista previa"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-black",children:s.nombre||"Nombre del producto"}),e.jsx("span",{className:"text-muted-foreground",children:" - "}),e.jsxs("span",{className:"text-primary font-black",children:["$",s.precio||"0.00","/",s.unidad]})]})]})]})]}),e.jsx(L,{children:e.jsx(l,{onClick:E,className:"w-full h-12 rounded-2xl font-black uppercase","data-testid":"button-save",children:r?"Guardar Cambios":"Crear Producto"})})]})})]})})}export{te as default};
