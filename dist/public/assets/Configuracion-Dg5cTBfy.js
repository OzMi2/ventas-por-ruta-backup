import{c as C,a as w,b as y,r as j,j as e}from"./index--GjonhCH.js";import{A as _}from"./AppShell-DiZMTW7V.js";import{C as i,a as c,b as l,c as p}from"./card-Dph2jOn3.js";import{I as A,B as d}from"./api-DC912d50.js";import{D as R}from"./download-BMtY1tmq.js";const U=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],L=C("database",U),E={};function S(t){return t.trim().replace(/\/+$/,"")}function $(){const{state:t,dispatch:n}=w(),{toast:s}=y(),[u,m]=j.useState(t.apiBaseUrl||""),[x,h]=j.useState(!1),k=t.session?.rol==="admin";async function N(){h(!0);try{const a=localStorage.getItem("auth_token"),b=await fetch("/api/backup",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)throw new Error("Error al generar backup");const r=await b.json(),v=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(v),o=document.createElement("a");o.href=f,o.download=`backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(f),s({title:"Backup Descargado",description:`Rutas: ${r.counts.rutas}, Clientes: ${r.counts.clientes}, Productos: ${r.counts.productos}, Ventas: ${r.counts.ventas}`})}catch(a){s({title:"Error",description:a.message,variant:"destructive"})}finally{h(!1)}}const g=(E?.VITE_API_BASE_URL||"").trim();return e.jsx(_,{title:"Configuración",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs(i,{className:"shadow-sm rounded-3xl border-none bg-card/60",children:[e.jsx(c,{children:e.jsx(l,{className:"text-sm font-black uppercase tracking-widest",children:"API Red Local"})}),e.jsxs(p,{className:"grid gap-4",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground leading-relaxed",children:"Configura la IP y el puerto de tu servidor en la LAN."}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-muted-foreground ml-1",htmlFor:"apiBaseUrl",children:"URL del Servidor"}),e.jsx(A,{id:"apiBaseUrl",className:"h-12 rounded-2xl bg-background border-none font-bold",value:u,onChange:a=>m(a.target.value),placeholder:"http://192.168.1.XX:8080","data-testid":"input-api-base-url"}),e.jsxs("div",{className:"text-[10px] font-bold text-primary px-1",children:["ACTUAL: ",t.apiBaseUrl||"SIN CONFIGURAR"]})]}),g&&e.jsxs("div",{className:"p-3 rounded-2xl bg-primary/5 border border-primary/10 text-[10px] font-bold text-primary uppercase",children:["Vía Entorno: ",g]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{className:"h-12 rounded-2xl font-black uppercase tracking-tighter",onClick:()=>{const a=S(u);n({type:"API_BASE_URL_SET",apiBaseUrl:a}),s({title:"Guardado",description:"Configuración actualizada."})},"data-testid":"button-save-api-base-url",children:"Guardar Cambios"}),e.jsx(d,{variant:"secondary",className:"h-12 rounded-2xl font-bold text-xs uppercase opacity-70",onClick:()=>{n({type:"API_BASE_URL_SET",apiBaseUrl:""}),m(""),s({title:"Restaurado",description:"Usando valor de entorno."})},"data-testid":"button-clear-api-base-url",children:"Limpiar Custom URL"})]})]})]}),k&&e.jsxs(i,{className:"shadow-sm rounded-3xl border-none bg-card/60",children:[e.jsx(c,{children:e.jsxs(l,{className:"text-sm font-black uppercase tracking-widest flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Respaldo de Datos"]})}),e.jsxs(p,{className:"grid gap-3",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Descarga un respaldo completo de todos los datos del sistema (rutas, clientes, productos, ventas)."}),e.jsxs(d,{className:"h-12 rounded-2xl font-black uppercase tracking-tighter gap-2",onClick:N,disabled:x,"data-testid":"button-download-backup",children:[e.jsx(R,{className:"h-4 w-4"}),x?"Generando...":"Descargar Respaldo"]})]})]}),e.jsxs(i,{className:"shadow-sm rounded-3xl border-none bg-card/60",children:[e.jsx(c,{children:e.jsx(l,{className:"text-sm font-black uppercase tracking-widest",children:"Mantenimiento"})}),e.jsxs(p,{className:"grid gap-3",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Limpia el estado local si experimentas errores tras un cambio de API."}),e.jsx(d,{variant:"destructive",className:"h-12 rounded-2xl font-black uppercase tracking-tighter bg-destructive/10 text-destructive hover:bg-destructive/20 border-none shadow-none",onClick:()=>{n({type:"CLIENT_SET",client:null}),n({type:"CART_CLEAR"}),s({title:"Limpiado",description:"Estado reseteado."})},"data-testid":"button-clear-client-cart",children:"Resetear Sesión"})]})]})]})})}export{$ as default};
