import{a as l}from"./offlineCache-DJaRb9T9.js";const d="vr_offline_descuentos";function m(e){return{id:e.id,clienteId:e.clienteId,productoId:e.productoId,mode:e.tipoDescuento,tiers:e.tiers.map(t=>({minQty:parseFloat(t.volumenDesde),discountAmount:parseFloat(t.descuentoMonto)})),active:e.activo,clienteNombre:e.clienteNombre,productoNombre:e.productoNombre}}function y(){try{const e=localStorage.getItem(d);return e?JSON.parse(e):[]}catch{return[]}}function D(e){try{localStorage.setItem(d,JSON.stringify(e))}catch{}}async function A(){try{const t=(await l.getDescuentos()).rules.map(m);return D(t),console.log(`[Descuentos] ${t.length} reglas cargadas del servidor`),t}catch{const t=y();return t.length>0?(console.log(`[Descuentos] Usando ${t.length} reglas del cache (offline)`),t):(console.warn("[Descuentos] No hay reglas en cache"),[])}}async function v(e){try{const t=e.tiers.map(o=>({volumenDesde:o.minQty.toFixed(3),descuentoMonto:o.discountAmount.toFixed(2)})),s=await l.createDescuento(e.productoId,e.mode,t,e.clienteId);return m(s.rule)}catch{return null}}async function N(e){try{return await l.deleteDescuento(e),!0}catch{return!1}}function b(e,t,s,o,f="PIEZA"){const r=e.filter(n=>n.active&&n.productoId===s&&(n.mode===f||n.mode==="MIXTO")&&(n.clienteId===null||n.clienteId===t));if(r.length===0)return null;const a=r.filter(n=>n.clienteId===t),h=r.filter(n=>n.clienteId===null),p=a.length>0?a:h;let c=null;for(const n of p){const i=[...n.tiers].sort((u,g)=>g.minQty-u.minQty).find(u=>o>=u.minQty);i&&(!c||i.discountAmount>c.discountAmount)&&(c={discountAmount:i.discountAmount,mode:n.mode})}return c}export{b as a,v as c,N as d,A as f};
