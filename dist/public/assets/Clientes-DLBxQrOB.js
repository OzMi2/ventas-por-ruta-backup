import{a as C,r as i,j as e}from"./index-B_foZYmG.js";import{g as y,a as S,A as k,B as w}from"./AppShell-C0i3IliG.js";import{a as A,B as g}from"./api-BvF3Zc_M.js";import{C as d}from"./card-BOyt3Fg8.js";import{A as j,a as b,b as N}from"./alert-B8vvGeA4.js";import{S as o}from"./skeleton-DnJG9wbu.js";import{S as L}from"./SearchInput-DMXRaTAW.js";import"./search-D8th6uVw.js";async function $(s){try{return(await A.getClientes(s)).clientes}catch(a){const n=y();if(n&&n.length>0)return console.log("Usando clientes desde cache offline"),n;const r=S();if(r?.clientes&&r.clientes.length>0)return console.log("Usando clientes desde bootstrap cache"),r.clientes;throw a}}function E(s,a){const n=s?.id??s?.cliente_id??a;return{id:String(n),nombre:String(s?.nombre??s?.razon_social??s?.cliente??`Cliente ${a+1}`),saldo:s?.saldo!=null?Number(s.saldo):s?.saldo_anterior!=null?Number(s.saldo_anterior):void 0}}function O(){const{state:s,dispatch:a}=C(),[n,r]=i.useState(""),[v,c]=i.useState(!1),[m,x]=i.useState(null),[h,u]=i.useState([]);async function p(){c(!0),x(null);try{const t=await $(),l=Array.isArray(t)?t:Array.isArray(t?.data)?t.data:[];u(l.map(E))}catch(t){x(t?.message||"No se pudieron cargar los clientes."),u([])}finally{c(!1)}}i.useEffect(()=>{p()},[]);const f=h.filter(t=>t.nombre.toLowerCase().includes(n.trim().toLowerCase()));return e.jsx(k,{title:"Seleccionar cliente",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(L,{value:n,onChange:r,placeholder:"Buscar cliente...",testId:"search-clientes"})}),e.jsx(g,{onClick:p,variant:"outline",size:"icon",className:"shrink-0 h-10 w-10 rounded-xl","data-testid":"button-refresh-clientes",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),e.jsx("path",{d:"M3 3v5h5"}),e.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"}),e.jsx("path",{d:"M16 16h5v5"})]})})]}),m?e.jsxs(j,{variant:"destructive",className:"rounded-2xl","data-testid":"alert-clientes-error",children:[e.jsx(b,{children:"Error"}),e.jsx(N,{"data-testid":"text-clientes-error",children:m})]}):null,v?e.jsx("div",{className:"grid gap-2",children:Array.from({length:6}).map((t,l)=>e.jsx(d,{className:"p-4 rounded-2xl","data-testid":`card-cliente-skeleton-${l}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(o,{className:"h-4 w-2/3"}),e.jsx(o,{className:"mt-2 h-3 w-1/3"})]}),e.jsx(o,{className:"h-8 w-20 rounded-full"})]})},l))}):f.length===0?e.jsxs(d,{className:"p-8 text-center rounded-3xl bg-muted/20 border-dashed","data-testid":"empty-clientes",children:[e.jsx("div",{className:"text-sm font-bold",children:"Sin clientes"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground font-medium",children:h.length===0?"No llegaron datos del API.":"No hay coincidencias."})]}):e.jsx("div",{className:"grid gap-2",children:f.map(t=>e.jsxs(d,{className:`p-3 shadow-sm active:scale-[0.98] transition-transform border-none flex items-center justify-between gap-3 rounded-2xl ${s.selectedClient?.id===t.id?"bg-primary/10 ring-1 ring-primary":"bg-card/60"}`,"data-testid":`card-cliente-${t.id}`,onClick:()=>{s.selectedClient?.id===t.id?a({type:"CLIENT_SET",client:null}):a({type:"CLIENT_SET",client:t})},children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-bold","data-testid":`text-cliente-nombre-${t.id}`,children:t.nombre}),e.jsxs("div",{className:`mt-0.5 text-[11px] font-bold ${t.saldo&&t.saldo>0?"text-destructive":"text-muted-foreground"}`,"data-testid":`text-cliente-saldo-${t.id}`,children:["SALDO: ",t.saldo!=null?`$${Number(t.saldo).toFixed(2)}`:"$0.00"]})]}),e.jsx("div",{className:"shrink-0",children:s.selectedClient?.id===t.id?e.jsx(w,{className:"rounded-full h-6 px-2 text-[10px] font-black uppercase tracking-tighter",children:"LISTO"}):e.jsx(g,{size:"sm",variant:"secondary",className:"h-8 rounded-full text-[11px] font-black uppercase px-4 bg-background shadow-sm border-none","data-testid":`button-select-cliente-${t.id}`,children:"Elegir"})})]},t.id))}),s.selectedClient?e.jsx("div",{className:"sticky bottom-4 left-0 right-0 animate-in slide-in-from-bottom-4",children:e.jsxs(j,{className:"rounded-2xl shadow-xl border-primary/20 bg-primary text-primary-foreground",children:[e.jsx(b,{className:"text-xs font-black uppercase tracking-widest",children:"Cliente Actual"}),e.jsx(N,{className:"text-sm font-bold",children:s.selectedClient.nombre})]})}):null]})})}export{O as default};
