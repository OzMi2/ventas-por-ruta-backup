import{c as K,b as O,r as s,j as e}from"./index-wdjF8QO9.js";import{A as L,P as F}from"./AppShell-dgPPhMBH.js";import{C as V}from"./card-BXHACzTM.js";import{B as k,I as g}from"./api-h81SHs0i.js";import{L as p}from"./label-B6RIRDb6.js";import{S as X,a as _,b as D,c as G,d as J}from"./select-IcSS71jC.js";import{P as B}from"./plus-ButjlTfQ.js";import{S as Y}from"./scale-Dw4dD3tP.js";const Z=[["path",{d:"M5 12h14",key:"1ays0h"}]],M=K("minus",Z);function se(){const{toast:l}=O(),[y,I]=s.useState(!1),[P,R]=s.useState([]),[i,w]=s.useState(""),[c,h]=s.useState(""),[m,b]=s.useState(""),[x,f]=s.useState(""),[j,$]=s.useState(""),[t,z]=s.useState("entrada"),r=P.find(a=>a.id.toString()===i),d=r?.unidad==="MIXTO",T=async()=>{try{const a=localStorage.getItem("auth_token"),o=await fetch("/api/productos",{headers:{Authorization:`Bearer ${a}`}});if(o.ok){const n=await o.json();R(n.productos||[])}}catch(a){console.error("Error cargando productos:",a)}};s.useEffect(()=>{T()},[]);const A=async a=>{if(a.preventDefault(),!i){l({title:"Validación",description:"Selecciona un producto.",variant:"destructive"});return}if(d){const o=parseFloat(m)||0,n=parseFloat(x)||0;if(o<=0&&n<=0){l({title:"Validación",description:"Ingresa piezas y/o kilogramos.",variant:"destructive"});return}}else if(!c||parseFloat(c)<=0){l({title:"Validación",description:"Ingresa una cantidad válida.",variant:"destructive"});return}I(!0);try{const o=localStorage.getItem("auth_token");let n="",N={};d?(n=t==="entrada"?"/api/bodega/entrada-mixto":"/api/bodega/salida-mixto",N={productoId:parseInt(i),piezas:parseFloat(m)||0,kg:parseFloat(x)||0,notas:j.trim()||void 0}):(n=t==="entrada"?"/api/bodega/entrada":"/api/bodega/salida",N={productoId:parseInt(i),cantidad:parseFloat(c),notas:j.trim()||void 0});const C=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(N)});if(!C.ok){const u=await C.json();throw new Error(u.error||"Error al registrar operación")}const E=t==="entrada"?"agregaron":"retiraron";let v="";if(d){const u=parseFloat(m)||0,S=parseFloat(x)||0;v=`Se ${E} ${u>0?u+" pzs":""}${u>0&&S>0?" + ":""}${S>0?S+" kg":""} de ${r?.nombre}`}else v=`Se ${E} ${c} ${r?.unidad==="KG"?"kg":"piezas"} de ${r?.nombre}`;l({title:"Éxito",description:v}),h(""),b(""),f(""),$(""),w("")}catch(o){l({title:"Error",description:o.message,variant:"destructive"})}finally{I(!1)}};return e.jsx(L,{title:t==="entrada"?"Entrada a Bodega":"Salida de Bodega",children:e.jsxs("div",{className:"grid gap-6 pb-20",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:t==="entrada"?"default":"outline",className:"flex-1 h-12 rounded-2xl font-black uppercase text-xs",onClick:()=>z("entrada"),"data-testid":"button-modo-entrada",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Entrada"]}),e.jsxs(k,{variant:t==="salida"?"destructive":"outline",className:"flex-1 h-12 rounded-2xl font-black uppercase text-xs",onClick:()=>z("salida"),"data-testid":"button-modo-salida",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Salida"]})]}),e.jsxs(V,{className:"p-6 rounded-3xl border-none shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`grid h-12 w-12 place-items-center rounded-2xl ${t==="entrada"?"bg-green-500/10":"bg-red-500/10"}`,children:t==="entrada"?e.jsx(B,{className:"h-6 w-6 text-green-500"}):e.jsx(M,{className:"h-6 w-6 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-black",children:t==="entrada"?"Registrar Entrada":"Registrar Salida"}),e.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:t==="entrada"?"Agregar stock al inventario central":"Retirar stock del inventario central"})]})]}),e.jsxs("form",{onSubmit:A,className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(p,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Producto (ID - Nombre)"}),e.jsxs(X,{value:i,onValueChange:a=>{w(a),h(""),b(""),f("")},children:[e.jsx(_,{className:"h-12 rounded-2xl bg-muted/30 border-none font-bold","data-testid":"select-producto",children:e.jsx(D,{placeholder:"Seleccionar producto..."})}),e.jsx(G,{className:"rounded-2xl max-h-60",children:P.map(a=>e.jsx(J,{value:a.id.toString(),className:"font-bold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-primary font-black",children:["#",a.id]}),e.jsxs("span",{children:["- ",a.nombre]}),e.jsxs("span",{className:`text-xs px-1.5 py-0.5 rounded ${a.unidad==="MIXTO"?"bg-purple-500/20 text-purple-700":"text-muted-foreground"}`,children:["(",a.unidad,")"]})]})},a.id))})]})]}),r&&e.jsx(V,{className:`p-3 rounded-2xl ${d?"bg-purple-500/5 border-purple-500/20":"bg-primary/5 border-primary/20"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsx(Y,{className:"h-5 w-5 text-purple-500"}):e.jsx(F,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black",children:"Producto seleccionado:"}),e.jsxs("div",{className:`text-sm font-bold ${d?"text-purple-700":"text-primary"}`,children:["#",r.id," - ",r.nombre,d&&e.jsx("span",{className:"ml-2 text-xs bg-purple-500/20 px-2 py-0.5 rounded",children:"MIXTO"})]})]})]})}),d?e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(p,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Piezas"}),e.jsx(g,{type:"number",step:"1",min:"0",value:m,onChange:a=>b(a.target.value),placeholder:"0",className:"h-12 rounded-2xl bg-muted/30 border-none font-bold text-lg text-center","data-testid":"input-piezas"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(p,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Kilogramos"}),e.jsx(g,{type:"number",step:"0.001",min:"0",value:x,onChange:a=>f(a.target.value),placeholder:"0.000",className:"h-12 rounded-2xl bg-muted/30 border-none font-bold text-lg text-center","data-testid":"input-kg"})]})]}):e.jsxs("div",{className:"grid gap-1.5",children:[e.jsxs(p,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:["Cantidad (",r?.unidad==="KG"?"Kilogramos":"Piezas",")"]}),e.jsx(g,{type:"number",step:"0.001",min:"0",value:c,onChange:a=>h(a.target.value),placeholder:"0.00",className:"h-12 rounded-2xl bg-muted/30 border-none font-bold text-lg text-center","data-testid":"input-cantidad"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx(p,{className:"text-[10px] font-black uppercase ml-1 text-muted-foreground",children:"Notas (opcional)"}),e.jsx(g,{value:j,onChange:a=>$(a.target.value),placeholder:"Ej: Proveedor XYZ, Factura #123",className:"h-12 rounded-2xl bg-muted/30 border-none font-bold","data-testid":"input-notas"})]}),e.jsx(k,{type:"submit",disabled:y||!i,variant:t==="salida"?"destructive":"default",className:"h-14 rounded-2xl font-black uppercase text-sm mt-2","data-testid":"button-submit",children:y?"Registrando...":t==="entrada"?"Registrar Entrada":"Registrar Salida"})]})]})]})})}export{se as default};
