import{u as j,a as N,b as w,r as i,j as e}from"./index--GjonhCH.js";import{C as v,a as S,b as C,c as I}from"./card-Dph2jOn3.js";import{a as y,I as x,B as E}from"./api-DC912d50.js";import{A as k,a as A,b as L}from"./alert-CCTvRFFI.js";async function T({usuario:a,password:o}){const s=await y.login(a,o);return{ok:!0,usuario_id:s.usuario.id,rol:s.usuario.rol,nombre:s.usuario.nombre,token:s.token,rutaId:s.usuario.rutaId}}function D(){const[,a]=j(),{dispatch:o,state:s}=N(),{toast:g}=w(),[n,h]=i.useState(""),[d,f]=i.useState(""),[u,c]=i.useState(!1),[m,l]=i.useState(null);i.useEffect(()=>{s.session&&a("/clientes")},[s.session,a]);async function b(r){if(r.preventDefault(),l(null),!n.trim()||!d.trim()){l("Ingresa usuario y contraseña.");return}c(!0);try{const t=await T({usuario:n.trim(),password:d.trim()}),p={usuario_id:t.usuario_id.toString(),rol:t.rol,nombre:t.nombre,token:t.token,rutaId:t.rutaId};o({type:"SESSION_SET",session:p}),g({title:"Sesión iniciada",description:`Bienvenido/a ${p.nombre}`.trim()}),a("/clientes")}catch(t){l(t?.message||"No se pudo iniciar sesión.")}finally{c(!1)}}return e.jsx("div",{className:"min-h-svh grid place-items-center p-6 app-noise app-grid",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("div",{className:"mx-auto mb-3 grid h-12 w-12 place-items-center rounded-2xl bg-primary text-primary-foreground shadow-md",children:e.jsx("span",{className:"text-sm font-semibold",children:"GS"})}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight","data-testid":"text-login-title",children:"Garlo's Sistema de Ventas"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground","data-testid":"text-login-subtitle",children:"Soluciones rápidas, ventas rápidas"})]}),e.jsxs(v,{className:"shadow-md",children:[e.jsx(S,{children:e.jsx(C,{children:"Iniciar sesión"})}),e.jsxs(I,{children:[m?e.jsxs(k,{variant:"destructive",className:"mb-4","data-testid":"alert-login-error",children:[e.jsx(A,{children:"Error"}),e.jsx(L,{"data-testid":"text-login-error",children:m})]}):null,e.jsxs("form",{onSubmit:b,className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",htmlFor:"usuario",children:"Usuario"}),e.jsx(x,{id:"usuario",className:"h-12 text-base rounded-xl",value:n,onChange:r=>h(r.target.value),placeholder:"Ej. vendedor01",autoComplete:"username","data-testid":"input-usuario"})]}),e.jsxs("div",{className:"grid gap-1.5",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-wider text-muted-foreground",htmlFor:"password",children:"Contraseña"}),e.jsx(x,{id:"password",className:"h-12 text-base rounded-xl",type:"password",value:d,onChange:r=>f(r.target.value),placeholder:"••••••••",autoComplete:"current-password","data-testid":"input-password"})]}),e.jsx(E,{type:"submit",size:"lg",className:"h-12 rounded-xl text-base font-bold shadow-lg shadow-primary/20",disabled:u,"data-testid":"button-login",children:u?"Entrando...":"Iniciar Sesión"}),e.jsx("div",{className:"mt-2 text-xs text-muted-foreground","data-testid":"text-login-hint",children:'Tip: configura la URL del API (IP/puerto) en "Configuración" si no es la predeterminada.'})]})]})]})]})})}export{D as default};
